# Task 5: カスタムコマンドを作成する

## 目的
Claude Codeのスラッシュコマンド機能を理解し、プロジェクト固有のカスタムコマンドを作成する

## 所要時間
約20分

## 前提条件
- Task 1-4が完了していること
- `.claude`ディレクトリが存在すること

## カスタムコマンドとは？

スラッシュコマンド（`/command`）は、よく使う指示を短いコマンドとして登録できる機能です。

### メリット
- 繰り返し使う指示を簡単に呼び出せる
- チーム全体で共通のコマンドを共有できる
- タイプミスを防げる
- 複雑な指示を簡潔に実行できる

## 実践課題

### 課題1: コマンドファイルの保存場所を理解する

カスタムコマンドは以下のディレクトリに保存します：

```
.claude/commands/
```

### 課題2: 最初のカスタムコマンドを作成する

#### 1. commandsディレクトリを作成

```bash
mkdir -p .claude/commands
```

#### 2. レビューコマンドを作成

`.claude/commands/review.md`を作成します：

```markdown
現在開いているファイルのコードをレビューしてください。

以下の観点でチェックしてください：
- コードの可読性
- パフォーマンス
- セキュリティ
- ベストプラクティスに従っているか
- 改善提案

レビュー結果は日本語で、具体的に説明してください。
```

#### 3. コマンドを使用

Claude Codeで以下のように入力：

```
/review
```

これで、ファイルのコードレビューが実行されます！

### 課題3: より実用的なコマンドを作成する

#### テストコマンド（`.claude/commands/test.md`）

```markdown
以下の手順でテストを実行してください：

1. 現在のファイルに対するテストファイルを探す
2. テストが存在する場合は実行する
3. テストが存在しない場合は、適切なテストファイルを作成する
4. テスト結果を報告する

Next.jsプロジェクトなので、Jest/Vitestを使用してください。
```

#### リファクタリングコマンド（`.claude/commands/refactor.md`）

```markdown
現在のファイルをリファクタリングしてください。

以下の観点で改善してください：
- コードの重複を削除
- 関数を適切なサイズに分割
- 変数名をわかりやすくする
- TypeScriptの型を適切に使用
- コメントを追加（必要に応じて）

変更内容と理由を説明してください。
```

#### ドキュメント生成コマンド（`.claude/commands/doc.md`）

```markdown
現在のファイルのドキュメントを生成してください。

以下を含めてください：
- ファイルの概要
- 主要な関数/コンポーネントの説明
- 使用例
- 注意点

日本語で、README.mdに追加できる形式で出力してください。
```

### 課題4: 引数を受け取るコマンドを作成

カスタムコマンドは引数を受け取ることができます。

#### 引数の使い方

- `$ARGUMENTS` - すべての引数を取得
- `$1`, `$2`, `$3`... - 個別の引数を取得（スペース区切り）

#### コンポーネント作成コマンド（`.claude/commands/component.md`）

```markdown
---
description: Reactコンポーネントを作成
argument-hint: <component-name>
---

Next.js 15のReactコンポーネント「$1」を作成してください。

以下を含むファイルを作成：
- TypeScriptを使用
- 関数コンポーネント
- Propsの型定義
- 基本的なスタイリング（Tailwind CSS）
- JSDocコメント

作成場所：`components/$1.tsx`
```

**Frontmatter（---で囲まれた部分）:**
- `description`: コマンドの説明
- `argument-hint`: 引数のヒント（`/help`で表示される）

**使用例：**
```
/component Button
```

これで、`components/Button.tsx`が作成されます。`$1`が"Button"に置き換わります。

#### PR作成コマンド（複数引数の例）

`.claude/commands/create-pr.md`:

```markdown
---
description: Pull Requestを作成
argument-hint: <branch-name> <title>
---

ブランチ「$1」からPull Requestを作成してください。

タイトル: $2
説明: 変更内容を要約してください

以下を実行：
1. 変更をコミット
2. ブランチをプッシュ
3. GitHub PRを作成
```

**使用例：**
```
/create-pr feature/new-button "Add new button component"
```

### 課題5: 高度な機能を活用する

#### Bashコマンドの実行

`!`で始まる行はBashコマンドとして実行されます。

`.claude/commands/build-and-test.md`:

```markdown
---
description: ビルドとテストを実行
---

プロジェクトをビルドしてテストを実行します。

!npm run build
!npm test

結果を報告してください。
```

#### ファイルの参照

`@`でファイルを参照できます。

`.claude/commands/review-with-standards.md`:

```markdown
---
description: コーディング規約に従ってレビュー
---

以下のコーディング規約に従って、現在のファイルをレビューしてください：

@docs/coding-standards.md

問題点を指摘し、修正案を提示してください。
```

#### $ARGUMENTSの活用

すべての引数をまとめて取得する例。

`.claude/commands/commit.md`:

```markdown
---
description: 変更をコミット
argument-hint: <commit-message...>
---

以下のメッセージで変更をコミットしてください：

$ARGUMENTS

Conventional Commits形式に従って、コミットメッセージを整形してからコミットを実行してください。
```

**使用例：**
```
/commit feat: add new authentication system
```

すべての引数が1つのメッセージとして扱われます。

## コマンドの実践

それぞれのコマンドを実際に使ってみましょう：

1. `example1/app/page.tsx`を開く
2. `/review`を実行してコードレビューを受ける
3. `/refactor`で改善提案を得る
4. `/component UserCard`で新しいコンポーネントを作成
5. `/test`でテストを作成・実行

## 確認事項

- [ ] `.claude/commands/`ディレクトリが作成されている
- [ ] 少なくとも3つのカスタムコマンドを作成した
- [ ] コマンドが正しく動作する
- [ ] コマンドの便利さを実感できた

## カスタムコマンドのベストプラクティス

### 1. わかりやすい名前をつける
- ❌ `/c` （何のコマンドか不明）
- ✅ `/component` （明確）

### 2. 詳細な指示を書く
- コマンドの目的
- 実行する手順
- 期待する出力形式

### 3. プロジェクトに合わせる
- 使用している技術スタック
- コーディング規約
- チームのワークフロー

### 4. よく使う操作をコマンド化
- コードレビュー
- テスト作成
- リファクタリング
- ドキュメント生成

## グローバルコマンド vs プロジェクトコマンド

### グローバルコマンド
場所：`~/.claude/commands/`
- すべてのプロジェクトで使用可能
- 汎用的な操作向け

### プロジェクトコマンド
場所：`<project>/.claude/commands/`
- 特定のプロジェクトでのみ使用
- プロジェクト固有の操作向け

## 応用課題（発展）

### 1. AIペアプログラミングコマンド

```markdown
# .claude/commands/pair.md

ペアプログラミングモードで以下を実行：

1. 実装したい機能を確認
2. 設計を一緒に考える
3. ステップバイステップで実装
4. 各ステップで説明と確認
5. テストを作成
6. リファクタリング

対話的に進めてください。
```

### 2. デバッグサポートコマンド

```markdown
# .claude/commands/debug.md

現在のファイルまたは指定されたエラーをデバッグ：

1. エラーメッセージを分析
2. 関連するコードを確認
3. 原因を特定
4. 修正方法を提案
5. 修正を適用
6. テストで確認

ステップごとに説明してください。
```

### 3. パフォーマンス最適化コマンド

```markdown
# .claude/commands/optimize.md

Next.jsアプリケーションのパフォーマンスを最適化：

1. 現在のコードを分析
2. パフォーマンスのボトルネックを特定
3. 最適化提案
4. 実装
5. Before/Afterを説明

React Server Components、動的インポート、画像最適化などを活用。
```

## 次のステップ

✅ カスタムコマンドをマスターしました！

これで基本的なClaude Codeの使い方は完了です。

### さらに学ぶには：
1. Claude Codeの公式ドキュメントを読む
2. 他のプロジェクトでも活用してみる
3. チームメンバーとコマンドを共有する
4. より複雑なワークフローを自動化する

## 振り返り

1. どのカスタムコマンドが最も便利でしたか？
2. 他にどんなコマンドがあると便利だと思いますか？
3. チームで共有したいコマンドはありますか？

## ヒント

- コマンドは `.md` ファイルなので、マークダウンで自由に記述できます
- コマンドの中で別のコマンドを参照することも可能です
- コマンドファイルは Git で管理して、チームで共有しましょう
- 定期的にコマンドを見直して改善しましょう
